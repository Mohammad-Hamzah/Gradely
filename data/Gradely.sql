CREATE DATABASE IF NOT EXISTS Gradely;
USE Gradely;

CREATE TABLE AcadYear(
StartYear YEAR NOT NULL,
EndYear YEAR NOT NULL
);

CREATE TABLE Adm(
Username VARCHAR(30) PRIMARY KEY,
Hashed_PW VARBINARY(60)
);

CREATE TABLE Subjects(
SubID CHAR(3) PRIMARY KEY,
SubName VARCHAR(30) NOT NULL
);

CREATE TABLE SubjectsArchive(
SubID CHAR(3) NOT NULL,
SubName VARCHAR(30) NOT NULL,
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE Exams(
Exam VARCHAR(30),
SubID CHAR(3),
MaxMarks INT,
PRIMARY KEY(Exam, SubID),
FOREIGN KEY(SubID) REFERENCES Subjects(SubID) ON DELETE CASCADE
);

CREATE TABLE ExamsArchive(
Exam VARCHAR(30),
SubID CHAR(3),
MaxMarks INT,
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE Teachers(
TID INT PRIMARY KEY,
TName VARCHAR(30)
);

CREATE TABLE TeachersArchive(
TID INT NOT NULL,
TName VARCHAR(30),
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE TeacherSubjects(
TID INT,
SubID CHAR(3),
PRIMARY KEY (TID, SubID),
FOREIGN KEY (TID) REFERENCES Teachers(TID) ON DELETE CASCADE,
FOREIGN KEY (SubID) REFERENCES Subjects(SubID) ON DELETE CASCADE
);

CREATE TABLE TeacherSubjectsArchive(
TID INT,
SubID CHAR(3),
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE CTs(
CTID INT PRIMARY KEY,
CTName VARCHAR(30),
Hashed_PW VARBINARY(60),
FOREIGN KEY(CTID) REFERENCES Teachers(TID) ON DELETE CASCADE
);

CREATE TABLE Class(
Class VARCHAR(15) PRIMARY KEY,
CTID INT,
CStream VARCHAR(15),
FOREIGN KEY(CTID) REFERENCES Teachers(TID) ON DELETE SET NULL
);

CREATE TABLE ClassArchive(
Class VARCHAR(15),
CTID INT,
CStream VARCHAR(15),
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE ClassSubjects(
Class VARCHAR(15),
SubID CHAR(3),
TID INT,
PRIMARY KEY (Class, SubID),
FOREIGN KEY (Class) REFERENCES Class(Class) ON DELETE CASCADE,
FOREIGN KEY (SubID) REFERENCES Subjects(SubID) ON DELETE CASCADE,
FOREIGN KEY (TID) REFERENCES Teachers(TID) ON DELETE SET NULL
);

CREATE TABLE ClassSubjectsArchive(
Class VARCHAR(15),
SubID CHAR(3),
TID INT,
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE Students(
GRNo INT PRIMARY KEY,
Name VARCHAR(30),
Father VARCHAR(30),
Mother VARCHAR(30),
DOB DATE,
Class VARCHAR(15) DEFAULT NULL,
Roll INT DEFAULT NULL,
FOREIGN KEY(Class) REFERENCES Class(Class) ON DELETE SET NULL
);

CREATE TABLE StudentsArchive(
GRNo INT NOT NULL,
Name VARCHAR(30),
Father VARCHAR(30),
Mother VARCHAR(30),
DOB DATE,
Class VARCHAR(15) DEFAULT NULL,
Roll INT DEFAULT NULL,
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE StudentSubjects(
GRNo INT,
SubID CHAR(3),
PRIMARY KEY (GRNo, SubID),
FOREIGN KEY (GRNo) REFERENCES Students(GRNo) ON DELETE CASCADE,
FOREIGN KEY (SubID) REFERENCES Subjects(SubID) ON DELETE CASCADE
);

CREATE TABLE StudentSubjectsArchive(
GRNo INT,
SubID CHAR(3),
AcadYear VARCHAR(10) NOT NULL
);

CREATE TABLE Marks(
GRNo INT,
SubID CHAR(3),
Exam VARCHAR(30),
Marks INT,
PRIMARY KEY (GRNo, SubID, Exam),
FOREIGN KEY (GRNo) REFERENCES Students(GRNo) ON DELETE CASCADE,
FOREIGN KEY (SubID) REFERENCES Subjects(SubID) ON DELETE CASCADE,
FOREIGN KEY (Exam, SubID) REFERENCES Exams(Exam, SubID) ON DELETE CASCADE
);

CREATE TABLE MarksArchive(
GRNo INT,
SubID CHAR(3),
Exam VARCHAR(30),
Marks INT,
AcadYear VARCHAR(10) NOT NULL
);